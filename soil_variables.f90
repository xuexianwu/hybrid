!======================================================================!
module soil_variables
!----------------------------------------------------------------------!
! Definitions for soil-related variables.
!----------------------------------------------------------------------!
use control_parameters
!----------------------------------------------------------------------!
implicit none
save
!----------------------------------------------------------------------!
! Texture index (n).
!----------------------------------------------------------------------!
integer :: ntexture
!----------------------------------------------------------------------!
! Global variables.
!----------------------------------------------------------------------!
! Layer depths (m).
!----------------------------------------------------------------------!
real*8, allocatable :: dz_ij  (:,:,:)
!----------------------------------------------------------------------!
! Fraction of textures in each layer (fraction).
!----------------------------------------------------------------------!
real*8, allocatable :: q_ij  (:,:,:,:)
!----------------------------------------------------------------------!
! Fraction of textures in each layer for cond. (fraction).
!----------------------------------------------------------------------!
real*8, allocatable :: qk_ij (:,:,:,:)
!----------------------------------------------------------------------!
! Water in layers (m).
!----------------------------------------------------------------------!
real*8, allocatable :: wbare  (:,:,:)
real*8, allocatable :: wvege  (:,:,:)
!----------------------------------------------------------------------!
! Heat in layers (J/m^2).
!----------------------------------------------------------------------!
real*8, allocatable :: htbare (:,:,:)
real*8, allocatable :: htvege (:,:,:)
!----------------------------------------------------------------------!
! Snow depth over surfaces (m water equivalent).
!----------------------------------------------------------------------!
real*8, allocatable :: snowbv (:,:,:)
!----------------------------------------------------------------------!
! Number of snow layers (n).
!----------------------------------------------------------------------!
real*8, allocatable :: nsnow_layers_ij (:,:,:)
!----------------------------------------------------------------------!
! Fraction of snow on surface (fraction).
!----------------------------------------------------------------------!
real*8, allocatable :: fr_snow_ij (:,:,:)
!----------------------------------------------------------------------!
! Depth of snow in snow layers (m water equivalent).
!----------------------------------------------------------------------!
real*8, allocatable :: wsn_ij (:,:,:,:)
!----------------------------------------------------------------------!
! Diagnostic monthly-mean volumetric water in top layer (m^3/m^3).
!----------------------------------------------------------------------!
real*8, allocatable :: aij_wtop (:,:)
!----------------------------------------------------------------------!
! Diagnostic monthly-mean total depth fractional saturation (fraction).
!----------------------------------------------------------------------!
real*8, allocatable :: aij_wtot (:,:)
!----------------------------------------------------------------------!
! Diagnostic monthly soil evaporation and sublimation (kg/m^2/mo.).
!----------------------------------------------------------------------!
real*8, allocatable :: aij_esoil (:,:)
!----------------------------------------------------------------------!
! Diagnostic monthly canopy interception (kg/m^2/mo.).
!----------------------------------------------------------------------!
real*8, allocatable :: aij_intercep (:,:)
!----------------------------------------------------------------------!
! Diagnostic monthly transpiration (kg/m^2/mo.).
!----------------------------------------------------------------------!
real*8, allocatable :: aij_transp (:,:)
!----------------------------------------------------------------------!
! Diagnostic monthly total runoff (kg/m^2/mo.).
!----------------------------------------------------------------------!
real*8, allocatable :: aij_trunoff (:,:)
!----------------------------------------------------------------------!
! Diagnostic monthly surface runoff (kg/m^2/mo.).
!----------------------------------------------------------------------!
real*8, allocatable :: aij_srunoff (:,:)
!----------------------------------------------------------------------!
! Mean grid box soil water (m).
!----------------------------------------------------------------------!
real*8, allocatable :: wtot (:,:)
!----------------------------------------------------------------------!
! Slope (units?).
!----------------------------------------------------------------------!
real*8, allocatable :: sl_ij (:,:)
!----------------------------------------------------------------------!
! Earth skin temperature (degC).
!----------------------------------------------------------------------!
real*8, allocatable :: tearth (:,:)
!----------------------------------------------------------------------!
! Local variables.
!----------------------------------------------------------------------!
! Water depth in layers (m).
!----------------------------------------------------------------------!
real*8, allocatable :: w (:,:)
!----------------------------------------------------------------------!
! Heat in layers (J/m^2).
!----------------------------------------------------------------------!
real*8, allocatable :: ht (:,:)
!----------------------------------------------------------------------!
! Layer depths (m).
!----------------------------------------------------------------------!
real*8, allocatable :: dz (:)
!----------------------------------------------------------------------!
! Layer boundaries (m).
!----------------------------------------------------------------------!
real*8, allocatable :: zb (:)
!----------------------------------------------------------------------!
! Layer centres (m).
!----------------------------------------------------------------------!
real*8, allocatable :: zc (:)
!----------------------------------------------------------------------!
! Sensible heat flux from bare soil to air, no snow (J/s).
!----------------------------------------------------------------------!
real*8, allocatable :: snsh (:)
!----------------------------------------------------------------------!
! Sensible heat flux from bare soil snow (J/s).
!----------------------------------------------------------------------!
real*8, allocatable :: snshs (:)
!----------------------------------------------------------------------!
! Place holder for heat in snow layers.
!----------------------------------------------------------------------!
real*8, allocatable :: hsn (:,:)
!----------------------------------------------------------------------!
! Water fluxes between layers (>0 is up) (m/s).
!----------------------------------------------------------------------!
real*8, allocatable :: f (:,:)
!----------------------------------------------------------------------!
! Heat flux between layers (>0 is up) (W)
!----------------------------------------------------------------------!
real*8, allocatable :: fh (:,:)
!----------------------------------------------------------------------!
! Heat flux at canopy boundaries (>0 is up) (W).
!----------------------------------------------------------------------!
real*8, allocatable :: fch (:)
!----------------------------------------------------------------------!
! Flux of heat down from snow to the ground (J/m^2).
!----------------------------------------------------------------------!
real*8, allocatable :: fhsng (:)
real*8, allocatable :: fhsng_scale (:)
!----------------------------------------------------------------------!
! Flux of radiative heat up from snow (J/m^2).
!----------------------------------------------------------------------!
real*8, allocatable :: thrmsn (:)
!----------------------------------------------------------------------!
! Heat of drip water (J/s).
!----------------------------------------------------------------------!
real*8, allocatable :: htdripw (:)
!----------------------------------------------------------------------!
! Heat of drip snow (J/s).
!----------------------------------------------------------------------!
real*8, allocatable :: htdrips (:)
!----------------------------------------------------------------------!
! Total LW heat (weighted with fr_snow, fm) (bare/veg) for
! diagnostics (J).
!----------------------------------------------------------------------!
real*8, allocatable :: thrm_tot (:)
!----------------------------------------------------------------------!
! Total sensible heat (weighted with fr_snow, fm) (bare/veg) (J/s).
!----------------------------------------------------------------------!
real*8, allocatable :: snsh_tot (:)
!----------------------------------------------------------------------!
! Total LW heat (weighted with fr_snow, fm) (bare/veg) for
! diagnostics (J).
!----------------------------------------------------------------------!
real*8, allocatable :: athrm_tot (:)
!----------------------------------------------------------------------!
! Total sensible heat (weighted with fr_snow, fm) (bare/veg) for
! diagnostics (J).
!----------------------------------------------------------------------!
real*8, allocatable :: asnsh_tot (:)
!----------------------------------------------------------------------!
! Total evaporation flux (m/s).
!----------------------------------------------------------------------!
real*8, allocatable :: evap_tot (:)
!----------------------------------------------------------------------!
! Evaporation limitation by canopy water for wet canopy (m/s).
!----------------------------------------------------------------------!
real*8, allocatable :: evap_max_wet (:)
!----------------------------------------------------------------------!
! Evaporation limitation by diffusion and precipitation for bare
! (evporation limit for unsaturated soil/canopy) (m/s).
!----------------------------------------------------------------------!
real*8, allocatable :: evap_max_dry (:)
!----------------------------------------------------------------------!
! Evaporation limitation by soil water (m/s).
!----------------------------------------------------------------------!
real*8, allocatable :: evap_max (:)
!----------------------------------------------------------------------!
! Transpiration for separate layers (m/s).
!----------------------------------------------------------------------!
real*8, allocatable :: evapdl (:,:)
!----------------------------------------------------------------------!
! Potential evaporation for canopy (m/s).
!----------------------------------------------------------------------!
real*8 :: epv
real*8 :: epvs
!----------------------------------------------------------------------!
! Potential evaporation for bare soil (m/s).
!----------------------------------------------------------------------!
real*8 :: epb
real*8 :: epbs
!----------------------------------------------------------------------!
! Bare soil evaporation (m/s).
!----------------------------------------------------------------------!
real*8 ::evapb
real*8 :: evapbs
!----------------------------------------------------------------------!
! Evaporation from wet canopy (m/s).
!----------------------------------------------------------------------!
real*8 ::evapvw
!----------------------------------------------------------------------!
! Evaporation (transpiration) from dry canopy (m/s).
!----------------------------------------------------------------------!
real*8 ::evapvd
real*8 :: evapvs
!----------------------------------------------------------------------!
! Evaporation from soil under canopy (m/s).
!----------------------------------------------------------------------!
real*8 ::evapvg
!----------------------------------------------------------------------!
! Total evaporation bare soil for diagnostics (m).
!----------------------------------------------------------------------!
real*8 :: aevapb
!----------------------------------------------------------------------!
! Total evaporation from wet canopy for diagnostics (m).
!----------------------------------------------------------------------!
real*8 :: aevapw
!----------------------------------------------------------------------!
! Total evaporation (transpiration) from dry canopy for diagnostics (m).
!----------------------------------------------------------------------!
real*8 :: aevapd
!----------------------------------------------------------------------!
! Total evaporation from soil under canopy for diagnostics (m).
!----------------------------------------------------------------------!
real*8 :: aevapvg
!----------------------------------------------------------------------!
! Transpiration efficiency for each soil layer (fraction).
!----------------------------------------------------------------------!
real*8, allocatable :: betadl (:)
!----------------------------------------------------------------------!
! Moisture physiological impact for each soil layer (fraction).
!----------------------------------------------------------------------!
real*8, allocatable :: f_swpl (:)
!----------------------------------------------------------------------!
! Snow depths on each surface (m water equivalent).
!----------------------------------------------------------------------!
real*8, allocatable :: snowd (:)
!----------------------------------------------------------------------!
! Snow depths in each snow layer (m water equivalent).
!----------------------------------------------------------------------!
real*8, allocatable :: wsn (:,:)
!----------------------------------------------------------------------!
! Fraction of snow on surface (fraction).
!----------------------------------------------------------------------!
real*8, allocatable :: fr_snow (:)
!----------------------------------------------------------------------!
! Temperature of layers numbered from top                       (deg C).
! tp (:,1) is temperature for bare soil fraction                (deg C).
! tp (:,2) is temperature for vegetation fraction               (deg C).
! tp (0,2) is canopy temperature                                (deg C).
! tp (0,1) is not used
! tp (1,:) is upper soil layer temperature                      (deg C).
! tp (2,:) is second soil layer temperature, etc.               (deg C).
!----------------------------------------------------------------------!
real*8, allocatable :: tp (:,:)
! Temperature of upper layer os snow (degC).
real*8, allocatable :: tsn1 (:)
!----------------------------------------------------------------------!
! Fraction of textures in each layer (fraction).
!----------------------------------------------------------------------!
real*8, allocatable :: q (:,:)
!----------------------------------------------------------------------!
! Fraction of textures in each layer for cond. (fraction).
!----------------------------------------------------------------------!
real*8, allocatable :: qk (:,:)
!----------------------------------------------------------------------!
! Specific heat capacity of layers (J/(m^2 degC)).
!----------------------------------------------------------------------!
real*8, allocatable :: shc (:,:)
!----------------------------------------------------------------------!
! Fraction of ice in layers (fraction).
!----------------------------------------------------------------------!
real*8, allocatable :: fice (:,:)
!----------------------------------------------------------------------!
! Saturated volumetric moisture content (m3/m3).
!----------------------------------------------------------------------!
real*8, allocatable :: thets (:,:)
!----------------------------------------------------------------------!
! Minimum volumetric moisture content (m3/m3).
!----------------------------------------------------------------------!
real*8, allocatable :: thetm (:,:)
!----------------------------------------------------------------------!
! Water saturated in layer (m).
!----------------------------------------------------------------------!
real*8, allocatable :: ws (:,:)
!----------------------------------------------------------------------!
! Relative volumetric water in layer (m).
!----------------------------------------------------------------------!
real*8, allocatable :: theta (:,:)
!----------------------------------------------------------------------!
! Fractional saturation of soil (fraction).
!----------------------------------------------------------------------!
real*8, allocatable :: soilsat (:,:)
!----------------------------------------------------------------------!
!  Water potential, matric and gravitational (m).
!----------------------------------------------------------------------!
real*8, allocatable :: h (:,:)
!----------------------------------------------------------------------!
! Infiltration capacity (m/s).
!----------------------------------------------------------------------!
real*8, allocatable :: xinfc (:)
!----------------------------------------------------------------------!
! DIffusivity of layers (kg/m/s).
!----------------------------------------------------------------------!
real*8, allocatable :: d (:,:)
!----------------------------------------------------------------------!
! Diffusitivity coefficients.
!----------------------------------------------------------------------!
real*8, allocatable :: xkus (:,:)
!----------------------------------------------------------------------!
! Conductivity of layers (m/s).
!----------------------------------------------------------------------!
real*8, allocatable :: xk (:,:)
!----------------------------------------------------------------------!
! Conductivity coefficients.
!----------------------------------------------------------------------!
real*8, allocatable :: xku (:,:)
!----------------------------------------------------------------------!
! Heat conductivities in soil layers ().
!----------------------------------------------------------------------!
real*8, allocatable :: xkh  (:,:)
!----------------------------------------------------------------------!
! Average heat conductivities between soil layers ().
!----------------------------------------------------------------------!
real*8, allocatable :: xkhm (:,:)
!----------------------------------------------------------------------!
! Fraction of wet and dry canopy (fraction).
!----------------------------------------------------------------------!
real*8 :: fw,fd,fd0
!----------------------------------------------------------------------!
! Fraction of snow that is exposed (i.e. not masked) (fraction).
!----------------------------------------------------------------------!
real*8 :: fm
!----------------------------------------------------------------------!
! Snow masking depth (m water equivalent).
!----------------------------------------------------------------------!
real*8 :: snowm
!----------------------------------------------------------------------!
! Number of layers (n).
!----------------------------------------------------------------------!
integer :: nsoil_layers
integer, allocatable :: nsnow_layers (:)
!----------------------------------------------------------------------!
real*8 :: dtr ! Time remaining to complete timestep (s)
!----------------------------------------------------------------------!
real*8 :: dtm ! Minimum timestep for stability (s)
!----------------------------------------------------------------------!
! Underground runoff (m/s).
!----------------------------------------------------------------------!
real*8, allocatable :: rnff (:,:)
!----------------------------------------------------------------------!
! Surface runoff (m/s).
!----------------------------------------------------------------------!
real*8, allocatable :: rnf (:)
!----------------------------------------------------------------------!
! Slope (units?).
!----------------------------------------------------------------------!
real*8 :: sl
!----------------------------------------------------------------------!
! Liquid water flux from canopy (m/s).
!----------------------------------------------------------------------!
real*8, allocatable :: dripw (:)
!----------------------------------------------------------------------!
! Snow flux from canopy (m/s).
!----------------------------------------------------------------------!
real*8, allocatable :: drips (:)
!----------------------------------------------------------------------!
! Total surface runoff for diagnostics (m).
!----------------------------------------------------------------------!
real*8, allocatable :: trnf (:)
!----------------------------------------------------------------------!
! Total surface runoff energy for diagnostics (J).
!----------------------------------------------------------------------!
real*8, allocatable :: trnfe (:)
!----------------------------------------------------------------------!
! Total underground runoff for diagnostics (m).
!----------------------------------------------------------------------!
real*8, allocatable :: trnff (:)
!----------------------------------------------------------------------!
! Total underground runoff energy for diagnostics (J).
!----------------------------------------------------------------------!
real*8, allocatable :: trnffe (:)
!----------------------------------------------------------------------!
! Derivative of heat flux from surface (J/s/K).
!----------------------------------------------------------------------!
real*8 :: dsnsh_dt
!----------------------------------------------------------------------!
! R * R.
!----------------------------------------------------------------------!
real*8 :: rt
!----------------------------------------------------------------------!
end module soil_variables
!======================================================================!
